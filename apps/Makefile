# ===== –ù–∞—Å—Ç—Ä–æ–π–∫–∏ =====
BACKEND_DIR=apps/backend-ts

# ===== –ö–æ–º–∞–Ω–¥—ã =====

# –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –Ω–æ–¥—ã Anvil
anvil:
	cd contracts && anvil --port 8545

# –ó–∞–ø—É—Å–∫ backend –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
dev:
	cd $(BACKEND_DIR) && pnpm dev

# –°–±–æ—Ä–∫–∞ backend (ts -> js)
build:
	cd $(BACKEND_DIR) && pnpm build

# –ó–∞–ø—É—Å–∫ backend –≤ "–ø—Ä–æ–¥–µ"
start:
	cd $(BACKEND_DIR) && pnpm start

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend (dev mode)
restart:
	@echo "üîÑ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Å—Ç–∞—Ä—ã–π backend (–ø–æ—Ä—Ç 3000)..."
	@pkill -f "tsx src/server.ts" || true
	@echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é –Ω–æ–≤—ã–π backend..."
	cd $(BACKEND_DIR) && pnpm dev

# Docker: –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–æ–¥–Ω—è—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-up:
	docker compose up --build -d

# Docker: –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker-down:
	docker compose down
